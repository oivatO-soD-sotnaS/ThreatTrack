"use server"

import { prisma } from "@/lib/prisma"

// READ (get all)
export async function getVulnerabilities() {
  return await prisma.n8n_vulnerability.findMany({
    orderBy: { created: "desc" },
  })
}

// READ (get one by ID)
export async function getVulnerability(id: string) {
  return await prisma.n8n_vulnerability.findUnique({
    where: { n8n_vulnerability_id: id },
  })
}

export async function getBacklogVulnerabilities() {
  return await prisma.n8n_vulnerability.findMany({
    where: {
      AND: [
        { to_do_item: {  } },
        { in_development_item: { none: {} } },
        { ready_item: { none: {} } },
      ],
    },
  })
}

export async function getKanbanVulnerabilities() {
  return await prisma.n8n_vulnerability.findMany({
    where: {
      OR: [
        { to_do_item: { some: {} } },
        { in_development_item: { some: {} } },
        { ready_item: { some: {} } },
      ],
    },
    include: {
      to_do_item: true,
      in_development_item: true,
      ready_item: true,
    },
  })
}
